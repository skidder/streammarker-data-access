box: golang
build:
  # The steps that will be executed on build
  steps:
    - skidder/glide-install@1.0.2
  
    - script:
        name: Copy source to GOPATH
        code: |
          rm -rf vendor
          mkdir -p ${GOPATH}/src/github.com/skidder/streammarker-data-access
          cp -R . ${GOPATH}/src/github.com/skidder/streammarker-data-access

    - script:
        name: build
        code: |
          make build

    - script:
        name: test
        code: |
          make test
deploy:
  steps:
    - internal/docker-push:
        username: $DOCKERHUB_USERNAME
        password: $DOCKERHUB_PASSWORD
        tag: latest
        repository: skidder/streammarker-data-access
        registry: https://registry.hub.docker.com
